{% extends "thoughts/base.html" %}


{% block title %} Statistics {% endblock title %}


{% block main %}
  <div class="statistics-page">

    <h1><span class="glyphicon glyphicon-signal" aria-hidden="true"></span> Statistics</h1>

    <div class="chart-wrapper">
      <h2>Week Activity</h2>
      <canvas id="activityChart"></canvas>
    </div>

    <div class="chart-wrapper">
      <h2>Male / Female Activity</h2>
      <canvas id ="genderChart"></canvas>
    </div>

    <div class="chart-wrapper">
      <h2>Types of Thoughts</h2>
      <canvas id ="statusChart"></canvas>
    </div>
    
  </div>
{% endblock main %}



{% block javascript %}
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.4.0/Chart.min.js"></script>
  <script>
    var gc = $('#genderChart'); // gc - gender chart
    var genderChart = new Chart(gc, {
      type: 'pie',
      data: {
        labels: {{ genders_data.labels|safe }},
        datasets: [{
          data: {{ genders_data.values|safe }},
          backgroundColor: {{ genders_data.bgcolors|safe}},
        }]
      }, //end data
      options: {
        tooltips: {
          callbacks: {
            label: function(tooltipItem, data) {
              var dataset = data.datasets[tooltipItem.datasetIndex];
              var total = dataset.data.reduce(function(previous, current){
                return previous + current;
              });
              var currentValue = dataset.data[tooltipItem.index];
              var percentage = ((currentValue / total) * 100).toFixed(2);
              return percentage + '% (' + currentValue + ')';
            }
          }
        }
      }
    })

    var sc = $('#statusChart'); // sc - status chart
    var statusChart = new Chart(sc, {
      type: 'pie',
      data: {
        labels: {{ statuses_data.labels|safe }},
        datasets: [{
          data: {{ statuses_data.values|safe }},
          backgroundColor: {{ statuses_data.bgcolors|safe }},
        }]
      },
      options: {
        tooltips: {
          callbacks: {
            label: function(tooltipItem, data) {
              var dataset = data.datasets[tooltipItem.datasetIndex];
              var total = dataset.data.reduce(function(previous, current){
                return previous + current;
              });
              var currentValue = dataset.data[tooltipItem.index];
              var percentage = ((currentValue / total) * 100).toFixed(2);
              return percentage + '% (' + currentValue + ')';
            }
          }
        }
      } //end data
    })

    var ac = $('#activityChart'); // ac - activity chart
    var activityChart = new Chart(ac, {
      type: 'line',
      data: {
        labels: {{ activity_data.labels|safe }},
        datasets: [
          {
            label: "Thought per day",
            fill: true,
            lineTension: 0,
            backgroundColor: "rgba(75,192,192,0.4)",
            borderColor: "rgba(75,192,192,1)",
            borderCapStyle: 'butt',
            borderDash: [],
            borderDashOffset: 0.0,
            borderJoinStyle: 'miter',
            pointBorderColor: "rgba(75,192,192,1)",
            pointBackgroundColor: "#fff",
            pointBorderWidth: 2,
            pointHoverRadius: 5,
            pointHoverBackgroundColor: "rgba(75,192,192,1)",
            pointHoverBorderColor: "rgba(220,220,220,1)",
            pointHoverBorderWidth: 2,
            pointRadius: 1,
            pointHitRadius: 10,
            data: {{ activity_data.values|safe }},
            spanGaps: false,
          }
        ]
      },
      options: {
        scales: {
            yAxes: [{
                ticks: {
                    beginAtZero: true
                }
            }]
        }
      }
    })
  </script>
{% endblock javascript %}
